# Сбор данных границ населенных пунктов Иркутской области (ИО).

<img src="https://github.com/Lab42-Team/geoanalytics/blob/master/collecting%20the%20borders%20of%20localities/data/localities.png?raw=true" width=800 class="center">

Датасет `localities.csv` состоит из 1577 записей - полигонов - субъектов ИО.

|Название поля|Обозначение|
|:---|:--|
|name|Наименование населенного пункта Иркутской области
|type|Вид и категория населенного пункта Иркутской области
|name_MO|Наименование муниципального образования, в границах которого образован населенный пункт
|code|Код населенного пункта Иркутской области как объекта ОКАТО
|distance|Расстояние до административного центра района Иркутской области
|ado|Административно-территориального образования (АТО) Иркутской области, принадлежность к таким районам
|id|Идентификатор населенного пункта (без точки - родительский, с точкой - дочерний, например: город Иркутск - 34, Ленинский район - 34.3)
|query|Запрос, сформированный для поиска в Яндекс.Карты
|address|Адрес населенного пункта из Яндекс карт
|geometry|Геометрия полигона как json из Яндекс.Карты
|poly_wkt|Полигон в формате wkt
|poly|Полигон в формате wkb
|valid|Отсутствие ошибок полигона - 1, 0-полигон не найден, например, из-за упразднения или не обнаружения полигона территории

Алгоритм действия сбора:
1. `Reestr ATY 01 2020 (1).docx` - получение реестра населенных пунктов Иркутской области с сайта https://irkobl.ru/authorities/mestnoe-samoupravlenie/reestr-atu/ 
2. Конвертация данных в формат csv
3. Выбор способа сбора полигонов территорий и источника данных. На данном этапе был проведен поиск источников, отображающих границы населенных пунктов. Был выбран Яндекс.Карты, поскольку готового датасета не обнаружено, а в отличие от своих аналогов: GoogleMaps, OMS, 2GIS, имеет большее количество границ населенных пунктов и точнее их передает.
4. Был рассмотрен метод обратного геокодирования, при котором по координатам Яндекс возвращает полный адрес. Однако такой способ осуществляется по Яндекс.API, который имеет ограничение в 1000 запросов в день. Поэтому был выбран метод сбора территорий - парсинг Яндекс.Карты.
5. Был написан код - парсер, который по 7 потокам параллельно запускает агента - автоматического клиента браузера, который по наименованию, указанию АТО и упоминания иркутской области делает запрос в Яндекс карты и скачивает координаты найденного полигона из подгруженных страниц вкладки Network.
6. После чего, собранный датасет был проверен: 
  - на полноту записи территорий, какие были пропущены,
  - на дубликаты по полным адресам из Яндекс.Карты.
  
  Для первого случая заменялись строки запроса, заново запускался агент - парсер, в случае неуспеха - данные добавлялись вручную. Некоторые данные были добавлены из 2GIS, при отсутствии в Яндекс.Карты.
  Вторая проверка осуществлялась по количеству сгруппированных адресов. Далее действия осуществлялись как и в 1ом пункте.

В процессе сбора невалидными оказались участок Левый Сарам (упразднен) и урочище Бахвалово (отсутствие полигона).

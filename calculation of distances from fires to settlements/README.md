# Рассчет расстояний от пожаров до населенных пунктов и определение пожаров на территории населенных пунктов.

<img src="https://github.com/Lab42-Team/geoprocessing/blob/master/calculation of distances from fires to settlements/data/Кратчайшие расстояния от пожаров до населенных пунктов_v1.png?raw=true" width=800 class="center">

Добавлены поля для датасета записей пожаров в файл: `fires.csv`.

|Название поля|Обозначение|
|:---|:--|
|poly_wkt|Полигон пожара в формате wkt
|ado| Название аминистративно-территориального образования Иркутской области, если пожар находится на территории Иркутской области
|ado_id|Идентификатор аминистративно-территориального образования Иркутской области (взят из `localities.csv`)
|locality_name| Название населенного пункта, если пожар находится на его территории
|locality_id| Идентификатор населенного пункта (взят из `localities.csv`)
|nearest_loc_name| Идентификатор ближайшего населенного пункта
|distance_loc| Расстояние от центроида полигона пожара до ближайшего центроида полигона населенного пункта

**Алгоритм рассчета:**

Рассчет был произведен с помощью программы QGIS.
1. Загружены полигоны пожаров и населенных пунктов
2. Были присоеденены аттрибуты (`ado` и `id` (`ado_id`)) населенных пунктов по пространственному индексу файлу пожаров, для тех, которые имеют пересечения. Если полигон пожаров не имеет пересечений с полигонами населенных пунктов, то значения присоединяемых аттрибутов = Null. Также, если пожар пересекает (функция `intersects`) несколько населенных пунктов, то для каждого населенного пункта запись пожара добавляется.
3. По такой же технологии были добавлены аттрибуты `name` и `id` населенных пунктов, в последствии переименнованные в `locality_name` и `locality_id`.
4. С помощью функции: `Distance to Nearest Hub (line)` были построены линии от центроидов полигонов пожаров до ближайших центроидов полигонов населенных пунктов.

Проблемы возникли с мультиполигонами, которые для программы QGIS имели некорректную геометрию. Такие полигоны были найдены с помощью функции проверки геометрии и исправлены (функцией исправление геометрий). После чего подверглись пунктам 1-4 и добавлены к корректному датасету. Поэтому, можно было перед 2ым пунктом сначала сделать исправление геометрии.

Также, особенно при рассчете расстояний для мультиполигонов было обнаружено, что он может находиться на территории одного населенного пункта, но иметь ближайшее расстояние до другого:

<img src="https://github.com/Lab42-Team/geoanalytics/blob/master/calculation of distances from fires to settlements/data/Мультиполигон.png?raw=true" width=350 class="center">

Проект QGIS представлен в файле: `boundaries.qgz`. Слои для него находятся в папке `data` и имеют расширение `gpkg`

## Статистика:
Пожаров на территории Иркутской области: 23045
Количество пожаров в населенных пунктах: 1514

<img src="https://i.ibb.co/JB6vJZv/image.png" alt="image" border="0">

Количество пожаров по `fire_id`: 705

<img src="https://i.ibb.co/RcHHrPd/image.png" alt="image" border="0">

Количество разных пожаров по `fire_id` в населенных пунктах: 312

<img src="https://i.ibb.co/gzpP12p/image.png" alt="image" border="0">

Среднее расстояние от пожаров до населенных пунктов, которые не пересекаются с ними: 174.65975439314073 

Среднее расстояние от пожаров до населенных пунктов, которые находятся в них: 3.42361518866789
